---
title: "Как атомные свопы будут работать в Monero"
slug: "monero-atomic-swaps"
date: "2020-11-18"
image: "/images/atomic.png"
image_credit: "Illustration by CypherStack"
image_credit_url: "https://cypherstack.com"
---
В погоне за децентрализацией и в попытках создать по-настоящему не требующую разрешений систему, далеко немногие вещи представляются столь же желанными в криптовалютном пространстве, как атомные свопы. С момента своего создания проект Monero всеми силами пытался внедрить атомные свопы, однако функции обеспечения приватности создают уникальные проблемы, мешающие разработать соответствующий протокол.

Но давайте начнём с начала. Что такое атомные свопы? Это протокол, позволяющий без посредников обменивать две разные криптовалюты, использующие разные блокчейны. Это означает, что если кто-то захочет обменять криптовалюту А на криптовалюту B, он сможет сделать это, не прибегая к услугам биржи, централизованной или децентрализованной. Как можно догадаться, это потребует значительных исследований, а все технические детали, которые делают подобное возможным, довольно сложны. И снова LocalMonero поможет простому пользователю и даст простое объяснение.

Для начала рассмотрим простейшую форму атомного свопа, реализованную в Bitcoin. Если кто-то захочет обменять Bitcoin на другую монету, которая использует ту же технологию блокировки хеша по времени, то сможет сделать это следующим образом. Допустим, у Элис есть Bitcoin (BTC), но она хочет Litecoin (LTC), у Боба имеется LTC, но он хочет BTC. Они решают произвести атомный своп, чтобы каждый получил желаемую монету. Элис отправляет свой BTC на специальный адрес, используя скрипты, которые блокируют средства так, что даже она не может получить к ним доступ. Представьте, что Элис кладёт свой BTC в абонентский ящик. Как только ящик будет создан, она получит ключ и отправит хеш этого ключа Бобу. Таким образом, Боб не получает самого ключа, а только хеш, поэтому, пока он не может получить доступ к средствам.

Боб использует этот хеш как мнемоническую фразу, на основе которой он создаёт собственный абонентский ящик, после чего он кладёт в ящик свой LTC, где тот так же «запирается». Так как хеш ключа Элис был использован в качестве мнемонической фразы, с помощью которого был создан ящик Боба, она может использовать свой ключ, чтобы забрать LTC, который находится в ящике Боба. Её ключ подходит! Но, благодаря математической магии вуду, когда она использует свой ключ, чтобы открыть ящик с LTC, она раскрывает ключ Бобу, который затем сможет использовать его, чтобы взять BTC, который был положен Элис в ящик. Таким образом, без каких-либо посредников, Элис и Боб успешно обмениваются своими активами.

Но есть небольшая проблема. Что случится, если Элис положит актив в свой ящик, а Боб решит, что уже не желает ни с кем ничем обмениваться? Так как Элис не может получить доступ к своему BTC, который она уже «заперла», а Боб не желает завершать свою часть сделки, Элис может просто потерять свои деньги навсегда. К счастью, Bitcoin использует технологию под названием «транзакции возмещения», благодаря которой спустя какой-то период времени, если BTC не будет востребован Бобом, скрипты задействуют встроенную функцию безопасности, и BTC автоматически вернётся к Элис. Это и было основным препятствием для реализации атомных свопов в Monero. Из-за технологии обеспечения приватности Monero под названием [«кольцевые подписи»](/knowledge/ring-signatures) отправитель транзакции всегда скрыт. Как протокол сможет произвести транзакцию возмещения, если ему даже неизвестно, кто был источником транзакции?

В 2017 году небольшой группой исследователей был предложен другой метод, позволяющий проводить атомные свопы с Monero. После нескольких лет доработки, исследователи завершили разработку процесса, благодаря которому стали возможны атомные свопы между Monero и Bitcoin даже без транзакций возмещения.

Как и в случае со многими вещами подобного уровня технической сложности, в рамках нашего объяснения некоторые детали будут предельно упрощены, что позволит передать идею, но при этом всё равно создаст достаточное представление о механизмах, с помощью которых обеспечивается работа процесса.

Элис (у которой имеется XMR и которая хочет BTC) и Боб (у которого есть BTC и который хочет XMR) должны скачать и запустить программу, которая поддерживает проведение атомных свопов. Это может быть сделано при помощи кошелька, децентрализованной биржи или специальной программы, но программное обеспечение должно поддерживать протокол проведения атомных свопов. На первом этапе клиенты Элис и Боба подключаются друг к другу и создают несколько общих секретов и ключей. На этом этапе создается и новый адрес Monero. При этом у Элис появляется одна половина ключа, а у Боба — другая. Но пока ещё нет никаких Monero, поэтому, и тратить нечего. И последнее, что нужно отметить в отношении этого адреса: оба участника имеют ключ просмотра для этого кошелька, так что оба они могут заглянуть в него, чтобы увидеть, были ли на него получены Monero.

На втором этапе Боб отправляет свой BTC на специальный адрес, подобно тому, как это происходит в случае с протоколом проведения атомных свопов Bitcoin, который мы уже обсуждали. После того, как Элис увидит, что BTC поступил на этот адрес в блокчейне, она отправит свои XMR на адрес Monero, для которого у них с Бобом имеется по половине ключа. Боб может проверить, поступили Monero или нет, так как у него также есть ключ просмотра, и как только он увидит, что Monero благополучно поступили в кошелёк, он отправит часть ключа Элис, и эта часть позволит ей забрать Bitcoin. Как и в случае с другим протоколом, в процессе изъятия Bitcoin Элис показывает свою половину ключа Monero Бобу. Теперь у Боба есть обе половинки, и он может забрать Monero, в то время как у Элис имеется только её половина, так что она не сможет попытаться забрать Monero обратно, прежде чем это сделает Боб.

И если вы прочитали всё это и по-прежнему не понимаете, как Monero удалось решить проблему транзакций возмещения, то ответ довольно прост. Поскольку Monero не использует транзакций возмещения, читатель должен был заметить, что Bitcoin (который предполагает проведение таких транзакций) отправляется первым, и только после того, как его наличие в блокчейне будет подтверждено, отправляется Monero. Это позволяет Monero использовать способность Bitcoin проводить транзакции возмещения и использовать их в своих интересах, даже не имея такой возможности.

Атомный своп завершён, и теперь у Боба есть несколько вариантов использования вновь полученных XMR. Он может использовать этот кошелёк Monero как есть, или же переместить XMR в другой кошелёк, которым владеет. Боб, скорее всего, переместит Monero в другой кошелек, потому что у Элис по-прежнему имеется ключ просмотра, и она может увидеть, сколько Monero находится внутри кошелька.

Прелесть данного протокола заключается в том, что он пока ещё довольно новый, и есть много возможностей для его оптимизации. Также, протокол достаточно гибок по своей архитектуре, что позволяет использовать его реализацию для других кошельков или децентрализованных бирж, и будет соответствовать их уже существующей архитектуре.

Читайте также