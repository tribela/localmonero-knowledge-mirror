---
title: "Как ще работят атомните размяни в Monero"
slug: "monero-atomic-swaps"
date: "2020-11-18"
image: "/images/atomic.png"
image_credit: "Illustration by CypherStack"
image_credit_url: "https://cypherstack.com"
---
В стремежа към децентрализация и система без разрешения малко неща са толкова желани в пространството на криптовалутите като децентрализираните борси и атомните размяни. От самото си създаване Monero се бори да внедри атомни размени, тъй като функциите за поверителност създават уникални проблеми когато се опитвате да проектирате протокол.

Но първо нека обясним. Какво представляват атомните размени? Атомната размяна е протокол, чрез който две различни криптовалути, на различни блокчейни, могат да бъдат обменяни по бездоверен начин без посредник. Това означава че ако някой иска да обмени криптовалута A за криптовалута B, ще може да го направи без обмен централизиран или децентрализиран. Както може да си представите това изисква значително проучване и пълните технически подробности които го правят възможно стават доста сложни. Още веднъж LocalMonero е тук за да помогне и да даде просто обяснение за обикновения човек.

За да започнем нека разгледаме най-простата форма на атомна размяна реализирана от биткойн. Ако някой иска да обмени биткойн за друга монета която използва същата технология за договор за заключване на хеш време той може да го направи по следния начин. Иван има биткойн (BTC) но иска лайткойн (LTC), а Георги има LTC но иска BTC. Те решават да направят атомна размяна така че всеки да получи монетата която иска. Иван изпраща своите BTC на специален адрес използвайки скриптове които заключват средствата така че дори той да не може да получи достъп до тях. Можете да мислите за това като Иван който поставя своите BTC в ключалка. Когато кутията е направена той получава ключ и изпраща хеш от този ключ на Георги. Сега Георги няма самия ключ а само хеша така че все още няма достъп до средствата.

Георги използва този хеш като семе от което генерира своя собствена кутия за ключове и изпраща своя LTC там където той също е заключен. Тъй като хешът на ключа на Иван е използван като семе от което е направена кутията за ключове на Георги той може да използва своят ключ за да поиска LTC в кутията за ключове на Георги. Ключът му става! Но използвайки математическа вуду магия когато той използва ключа си за да отвори LTC ключалката той разкрива ключа на Георги който след това може да го използва за да поиска BTC които той е поставила в своята ключалка. По този начин без посредник Иван и Георги успешно са разменили активите си.

Но има малък проблем. Какво ще стане ако Иван изпрати до кутията си и Георги реши че не иска да търгува повече. Сега, тъй като Иван няма достъп до своите BTC които е заключила и Георги няма да завърши своята част от транзакцията Иван просто губи парите си завинаги. За щастие биткойнът има малка технология наречена транзакции за възстановяване и така след определен период от време ако BTC не бъде потърсен от Георги скриптовете имат вградена система за безопасност при която BTC автоматично ще се върнат при Иван. Това беше основното ускорение за внедряването на атомни размяни на Monero. Поради [ технологията за поверителност на подписите на Monero ](/knowledge/ring-signatures), подателят на транзакция винаги е несигурен. Как може протоколът да извърши транзакция за възстановяване ако дори не знае откъде идва транзакцията? 

През 2017 г. малка група изследователи очертаха различен метод чрез който атомните размени ще работят в Monero. След няколко години на усъвършенстване изследователите финализираха процес чрез който Monero ще може да прави атомни размяни с биткойни, дори без транзакции за възстановяване на средства.

Както при много неща от това ниво на техническа сложност нашето обяснение ще опрости прекалено някои неща за да предаде идеята но все пак ще даде солидна представа за механизмите чрез които ще работи този процес.

И Иван (която има XMR и иска BTC) и Георги (който има BTC и иска XMR) трябва да изтеглят и стартират програма която поддържа атомната размяна. Това може да бъде внедрено в портфейли, децентрализирани обмени или специални специфични програми но софтуерът трябва да изпълнява протокола за атомна размяна. В първата стъпка клиентите на Иван и Георги се свързват помежду си и правят няколко споделени тайни и ключове. В тази стъпка се създава нов адрес на Monero като Иван има едната половина на ключа а Георги има другата. Все още обаче няма Monero, така че няма какво да харчите. Едно последно нещо което трябва да се отбележи за този адрес е че и двамата имат ключа за преглед на този портфейл така че и двамата могат да надникнат вътре за да видят дали или кога Monero пристига.

Във втората стъпка Георги изпраща своите BTC на специален адрес подобен на протокола за атомна размяна на Биткойн който вече обсъдихме. След като Иван види че BTC пристигат на този адрес в блокчейна той изпраща своето Monero на адреса на Monero за който и двамата с Георги имат по една половина от ключ. Георги може да потвърди че Monero е пристигнал тъй като той също има ключа за преглед и след като види че Monero е безопасно в портфейла той изпраща на Иван част от ключ който ще й позволи да изтегли биткойните. Подобно на другия протокол процесът на искане на биткойн разкрива нейната половина от ключа на Monero на Георги. Сега Георги има и двете половини така че може да поиска Monero докато Иван има само своята половина така че не може да се опита да я вземе преди той да го направи.

Така че ако сте разгледали всичко това и все още сте малко объркани относно това как Monero успя да заобиколи проблема с транзакциите за възстановяване на средства отговорът е доста прост. Тъй като самият Monero няма транзакции за възстановяване на средства читателят трябва да забележи че биткойнът (който има транзакции за възстановяване) се изпраща първо и едва след като се потвърди че е в блокчейна, се изпраща Monero. Това позволява на Monero да използва способността на биткойн да изпълнява скриптове при транзакции за възстановяване и да се възползва от тях без да е необходимо самият той да има тези възможности.

Атомната размяна вече е завършена, но от тук нататък Георги има няколко опции за своя наскоро заявен XMR. Той може да използва този портфейл Monero такъв какъвто е или да премести XMR в друг портфейл който вече притежава. Георги най-вероятно ще премести Monero в друг портфейл защото Иван все още има ключа за преглед и може да види вътре.

Красотата на този протокол е че все още е доста нов и има много място за оптимизации. Също така е доста гъвкав в своята архитектура така че внедряването в други портфейли или децентрализирани борси трябва да е просто и да пасва чисто на съществуващата им архитектура.

Допълнителна информация